# -*- coding: utf-8 -*-
# @Author: leedagou
# @Date:   2019-03-16 16:57:05
# @Last Modified by:   leedagou
# @Last Modified time: 2019-09-15 16:46:44


'''
读取未分类的邮件，从中选取前15出现的高频词
'''

from wordcount import *


from operator import itemgetter


spam_path = 'data/spam/'
ham_path = 'data/easy_ham/'


def classify(mailname, spam_history, ham_history):
    word_dic = count_mail_words(mailname)
    new_word_list = sorted(word_dic.items(), key=itemgetter(1), reverse=True)[:14]  # 取出新邮件中出现次数最多的15个单词
    # 查询得到历史库中这些词出现的频率，如果历史库中不存在，则
    p = []
    for word in word_dic:
        if word in spam_history and word in ham_history:
            result = spam_history[word] * 0.5 / (spam_history[word] * 0.5 + ham_history[word] * 0.5)
            p.append(result)
        else:
            p.append(0.4)

    return p

    return new_word_list


def word_history(mail_path):
    '''
    正常邮件的词库
    '''
    words = {}
    words_list, file_num = mail_from_file(mail_path, words)
    # print(spam_words_list)
    print(file_num)
    for word in words_list:
        words_list[word] = words_list[word] / file_num

    return words_list


def decision(p_spam, p_ham):
    sum_1 = 1
    sum_2 = 1
    sum_3 = 1
    sum_4 = 1
    # p_spam = [0.42685370741482964, 0.3807615230460922, 0.4308617234468938, 0.3486973947895792, 0.36472945891783565,
    #           0.10020040080160321, 0.3587174348697395, 0.16032064128256512, 0.050100200400801605, 0.3807615230460922, 0.3967935871743487, 0.9519038076152304, 0.5791583166332666, 0.34468937875751504]
    for i in p_spam:
        sum_1 *= i
        temp = 1 - i
        sum_2 *= temp
        print(sum_1, sum_2)
    result_1 = sum_1 / (sum_1 + sum_2)

    for i in p_ham:
        sum_3 *= i
        temp = 1 - i
        sum_4 *= temp
    result_2 = sum_3 / (sum_3 + sum_4)
    print('----------------')
    print(result_1, result_2)
    if result_1 > result_2:
        print("it's spam")
    else:
        print("it's ham")


if __name__ == '__main__':
    spam_history = word_history(spam_path)
    new_word_list = sorted(spam_history.items(), key=itemgetter(1), reverse=True)
    print(new_word_list)
    # ham_history = word_history(ham_path)

    # p = classify('00006.3ca1f399ccda5d897fecb8c57669a283', spam_history, ham_history)
    # p = [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.8856196211631832, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.744797588841939, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.6822523423997089, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.518783282291915, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4138188808201623, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
    #      0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.28305717364483934, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.023410212471088383, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.8345099293178192, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.5719187875321704, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4]
    # p = [0.6313072268310247, 0.3452800220979214, 0.6395593812074881, 0.8111177202184611, 0.7388852281096167, 0.4, 0.4, 0.7829491083079599, 0.4, 0.4, 0.4, 0.7695859627520394, 0.4876796714579056, 0.4, 0.4692485766126509, 0.5742600249392925, 0.48519392435060626, 0.9616124317255174, 0.785461520653504, 0.7337246531483458, 0.13297400801390022, 0.2346080912285698, 0.49872113651422423, 0.4, 0.4, 0.3337783711615487, 0.9092562284051645, 0.4845964798351882, 0.30654786233957326, 0.9065142111211163, 0.9971767874217109, 0.35760263195537123, 0.766781562189636, 0.9318990575088658, 0.46228105412832926, 0.8423712751395178, 0.21773210242118096, 0.2503755633450175, 0.7669362885591152, 0.6079539077406563, 0.3973046850168457, 0.4, 0.92247339392527, 0.9513123231534784, 0.5431324777703637, 0.1942189346813977, 0.6065384848668648, 0.7730786721236925, 0.4, 0.5672931203552876, 0.5671582037766064, 0.9656602341115592, 0.9971767874217109, 0.2503755633450175, 0.2535432671585406, 0.4855746963290553, 0.6588863174020113, 0.6300067362258719, 0.4, 0.4, 0.4, 0.4, 0.9631318408747876, 0.4, 0.7727095262883914, 0.4624541626315274, 0.4, 0.6110022543876282, 0.6189209375708088, 0.4, 0.6583451835466372, 0.23291563795593234, 0.16873391275536345, 0.06862099253403602, 0.7944447713764491, 0.028303595688796302, 0.8253712519891447, 0.4550418638514743, 0.4, 0.4, 0.8196238977109376, 0.9901186162102219, 0.4, 0.4, 0.8336112037345781, 0.1391284990817519, 0.4897969179528938, 0.5177412674306227, 0.4952921180776409, 0.8320380014447206, 0.7414136495033309, 0.19575473237065508, 0.28966795775813553, 0.28305717364483934, 0.4290617848970252, 0.4, 0.4, 0.444771447783832, 0.4656143781719979, 0.5672931203552876, 0.8854172747829268, 0.4302901302918514, 0.22422865343219328, 0.9049342731948943, 0.5976474973764287, 0.9616124317255174, 0.4, 0.4, 0.5714819291801224, 0.4171533455698315, 0.4766898655734579, 0.4, 0.8682846862366457, 0.35760263195537123, 0.4, 0.957528300280875, 0.714694110920526, 0.9421382189239332, 0.40278033511323885, 0.4969758064516129, 0.9292587713383746, 0.7898062342038753, 0.4513975267427957, 0.4, 0.4, 0.4, 0.6571676076111957, 0.4, 0.2914185193819808, 0.9380381909764774, 0.8623068432671082, 0.6177568015023845, 0.4, 0.4, 0.9168194699116519, 0.6786832221230867, 0.914790330056351, 0.4, 0.4436759118108803, 0.9164430243977498, 0.4, 0.825759935071676, 0.4, 0.3634993754419822, 0.52024094523984, 0.9092562284051645, 0.6804354787063721, 0.5930758395729854, 0.7781236104935527, 0.7637202340038797, 0.35760263195537123, 0.4, 0.4457559939867925, 0.4717351029730339, 0.9460482214293436, 0.8350005511003638, 0.9133592811772026, 0.4, 0.8336112037345781, 0.8111177202184611, 0.8912832498167917, 0.6019835357502972, 0.9287041005857979, 0.45162358679452635, 0.723292427128288, 0.4, 0.23845860358641738, 0.34929210134128164, 0.4, 0.5560498220640568, 0.5905462863963001, 0.4, 0.20866371755279192, 0.8611666821235046, 0.6720831590895513, 0.4550418638514744, 0.8122712815075754, 0.43527465830939316, 0.4, 0.4, 0.6145094458880539, 0.6483783201863416, 0.7898062342038753, 0.8261405229110318, 0.2892200458413773, 0.1938610662358643, 0.4, 0.6254691018263697, 0.5785024240316295, 0.7262046928961043, 0.40864696988271826, 0.15899767863389191, 0.9559667029443775, 0.6645518174668383, 0.49432759089448575, 0.4, 0.8429618306883065, 0.7670246114853598, 0.714694110920526, 0.9342731201965342, 0.8614830910013306, 0.733150476979075, 0.8237204309841166, 0.5640761589595542, 0.714694110920526, 0.15177270519669742, 0.4, 0.41040337077968536, 0.7113117537154184, 0.7695859627520394, 0.9161843973797126, 0.5860713384066073, 0.2113309237338716, 0.4, 0.3736027258054875, 0.4, 0.864071328355892, 0.4, 0.5102392150778592, 0.4, 0.9659749528376935, 0.4, 0.6071258275208198, 0.7372301211163771, 0.8098323170731707, 0.5107043634580813, 0.5865511612072289, 0.4, 0.7321001513006979, 0.5887201224537855, 0.8706135743797351, 0.3198798364440488, 0.4, 0.6526279150713539, 0.42232457382481975, 0.4, 0.8336112037345783, 0.5117707267144319, 0.9944554939499328, 0.5, 0.41715334556983147, 0.5061184092136044, 0.6544613150027867, 0.4, 0.27312454479242537, 0.9376172021502688, 0.7671645179054097, 0.40220292286609804, 0.4, 0.24860073301701846, 0.2781795927450762,
    #      0.4419721413653034, 0.6474420382229664, 0.592383814827055, 0.8623068432671082, 0.41715334556983147, 0.8930485103950847, 0.4, 0.38152125726195973, 0.9678043744757727, 0.556049822064057, 0.4, 0.9898678145749151, 0.9834694316996008, 0.4, 0.4, 0.7724109520516707, 0.924904060799117, 0.4788594935034729, 0.4, 0.9101638294893081, 0.4, 0.4, 0.9888019927515905, 0.4345196298587985, 0.8377107828160879, 0.3900865992250279, 0.558775851058604, 0.7672288919987234, 0.508974924502053, 0.6254691018263697, 0.5, 0.9211980839079855, 0.518783282291915, 0.4, 0.6546583618577334, 0.8957095512495148, 0.40913773020014055, 0.2781795927450762, 0.4, 0.5887201224537855, 0.6456194718832721, 0.6540479024683769, 0.4, 0.48359173251574095, 0.6614654002713704, 0.7898062342038753, 0.9908016737635718, 0.4866112393293106, 0.6397393550689849, 0.86168456319221, 0.6885029192523776, 0.4290617848970252, 0.6561895075297746, 0.4, 0.4, 0.22762451060730218, 0.4, 0.4, 0.3251144402829796, 0.312930279133809, 0.752923640781407, 0.9933906409356414, 0.508974924502053, 0.714694110920526, 0.714694110920526, 0.6044391597304796, 0.4, 0.43527465830939316, 0.5659680436569876, 0.5213329440714017, 0.9059677910330932, 0.46924857661265096, 0.5005005005005004, 0.34727447416856705, 0.4974823766364552, 0.9874677217920997, 0.600480384307446, 0.9376172021502688, 0.6872436581155228, 0.3304427933430797, 0.9392007148078954, 0.4, 0.4, 0.5650082329771091, 0.6387599540092833, 0.5177412674306227, 0.621160880668093, 0.9092562284051645, 0.4, 0.5423350889429546, 0.4, 0.9804306051217694, 0.5560498220640568, 0.5688601032852083, 0.9835262787217184, 0.733150476979075, 0.4382032319173751, 0.4, 0.46151698757731346, 0.6184500517249134, 0.4, 0.4, 0.9268599708577981, 0.933272415253293, 0.6867053837702087, 0.03232062055591467, 0.9948087886479964, 0.7945977772104147, 0.4, 0.45039327521895256, 0.4843709635753035, 0.5075008196456752, 0.8336112037345781, 0.4, 0.49599595988745404, 0.4969920804790876, 0.9260631204622908, 0.2131014789242637, 0.4, 0.4, 0.8671963541869137, 0.4, 0.19639420244314384, 0.4, 0.4, 0.5832372935923219, 0.2276245106073022, 0.952471663967997, 0.4789684934525007, 0.5284492191385657, 0.4, 0.44256701074980015, 0.4, 0.7015263736994071, 0.8067639086097844, 0.4, 0.4, 0.32382129050257064, 0.6848429046470397, 0.5005005005005004, 0.6027203713878828, 0.810101017712953, 0.38508934072704865, 0.14310246136233543, 0.7018219297295779, 0.50577947411013, 0.4406847858367742, 0.21773210242118096, 0.6392283411804123, 0.7374396096752077, 0.4, 0.30702955986131714, 0.5005005005005005, 0.2535432671585406, 0.36631825730194395, 0.9376172021502688, 0.4, 0.6486045735888218, 0.5210537002863336, 0.5376877771160081, 0.47864164236990525, 0.08636473555117974, 0.744797588841939, 0.986138503847329, 0.4, 0.952471663967997, 0.4, 0.5528205486307508, 0.49599595988745404, 0.7348535380371497, 0.9336816835206023, 0.4054120749342528, 0.4, 0.812661960094864, 0.556049822064057, 0.6136822825204403, 0.8336112037345781, 0.4, 0.6900835001035125, 0.7107942305379072, 0.4341652279622838, 0.312930279133809, 0.8336112037345782, 0.4, 0.4, 0.8547595170640504, 0.6523166560097718, 0.6872436581155228, 0.5774116560166295, 0.727669637984355, 0.4550418638514743, 0.2945334590009425, 0.4, 0.7051144299989255, 0.6254691018263697, 0.4, 0.9777859745743848, 0.9616124317255174, 0.4, 0.11648495014444132, 0.34165751199743494, 0.6065384848668648, 0.8176064331197938, 0.4, 0.4, 0.5410377103284099, 0.5532586937059278, 0.24293452366025528, 0.2567921524318217, 0.9323298074315162, 0.3452800220979214, 0.4, 0.6501074999187365, 0.8632502055357633, 0.5380294496308927, 0.8976200246204349, 0.8464142813173284, 0.522170673553207, 0.71982839291113, 0.19768575871794195, 0.66711140760507, 0.5162592998376652, 0.4469233794558261, 0.8825606024947046, 0.32978366191778197, 0.38508934072704865, 0.4, 0.13416095737259182, 0.9940946046698778, 0.6254691018263697, 0.9804306051217694, 0.48437096357530357, 0.992381563077299, 0.26902436145766073, 0.31130988823975014, 0.35760263195537123, 0.30640583173863023, 0.16694490818030047, 0.34647393476588756, 0.4, 0.04394368177743403, 0.7656655164669129, 0.5410377103284099, 0.66711140760507, 0.7846522029110596, 0.4307578962378497, 0.5, 0.28612303290414876]
    print(p)
    p.sort()
    p.reverse()
    p = p[:15]
    print(p)

    result_1 = 1
    result_2 = 1
    for i in p:
        result_1 *= i
        result_2 *= (1 - i)

    result = result_1 / (result_1 + result_2)

    print(result)
